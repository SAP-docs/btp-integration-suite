<!-- loio161c1e3ca8cc4d838c0b8c04d847fde7 -->

# OAuth v2.0 SET

API Management generates and distributes OAuth access tokens to apps. API Management allows you to add or update custom attributes associated with an access token. This policy cannot be used to change fields like scope, status, expires\_in, developer\_email, client\_id, org\_name, or refresh\_count. If an attribute already exists, this policy updates it. If it does not exist, the policy adds it. The access token referenced must be valid and in an approved state.

When API Management generates these OAuth artifacts, it also generates 'profile' that contains metadata related to the token or code. For example, the default access token profile contains name/value pairs that define expiration time, the associated app and developer, and so on.

You can attach this policy in the following locations: ![](images/Flow_policy_116062b.png)

The JSON representation of an API Management access token looks like the following:

> ### Code Syntax:  
> ```
> 
> {
> "issued_at" : "1847470170943",
> "application_name" : "efd1903j-b667-4431-cf82-bbb3abf9t586",
> "scope": "READ",
> "status" : "approved",
> "api_product_list" : "[FreeProduct]",
> "expires_in" : "2450",
> "developer.email" : "adam@sap.com",
> "organization_id" : "0",
> "refresh_token" : "64XMXgDyRFpFyXOaApj1N7AGIPnN2IZe",
> "client_id" : "ceGYedE0Y9Z0T35PEMaAXYphBJCGdrND",
> "access_token" : "shTUmeI1geSKin0TODcGLXBNe9vp",
> "organization_name" : "apifactory",
> "refresh_count" : "0"
> }
> ```

In some situations, you will need to update the profile of an access token. For example, you may want to embed a tag that is unique to your business. You might need to embed a department name, a customer ID or more technically, a session identifier, in the access token.

There are two ways to do this: Using an API call or using the SetOAuthV2Info policy. You can call the management API to directly update the access token's profile.

Use the policy when you need tokens to be updated at runtime, such as at the time when the token or code is generated by API Management.

An example payload for the policy is as follows:

> ### Code Syntax:  
> ```
> 
> <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <SetOAuthV2Info async="false" continueOnError="false" enabled="true" xmlns="http://www.sap.com/apimgmt">
>     <AccessToken ref="request.access_token"></AccessToken>
>     <Attributes>
>         <Attribute display="true" name="department.id">marketing</Attribute>
>         <Attribute display="true" name="scope">READ, WRITE</Attribute>
>     </Attributes>
> </SetOAuthV2Info>
> 
> ```

OAuth v2.0 SET policy defines the following elements:


<table>
<tr>
<th valign="top">

**Field Name**

</th>
<th valign="top">

**Description**

</th>
</tr>
<tr>
<td valign="top">

AccessToken

</td>
<td valign="top">

Use the ref attribute to identify the variable where the access token is located. For example, if the access token is attached to request message as a query parameter, specifyrequest.queryparam.access\_token.

</td>
</tr>
<tr>
<td valign="top">

Attributes

</td>
<td valign="top">

A set of attributes in the access token profile that will be modified or augmented.

</td>
</tr>
<tr>
<td valign="top">

Attribute

</td>
<td valign="top">

An individual attribute to update.

The name attribute identifies the property of the access token profile to be updated. For example, to modify the access token's scope property, specify scope as the value of the name attribute.

The ref attribute specifies either variable or a static

setting whose value will be used as the value of the access token profile property that will be updated. For

example to update the attribute scope with the value

READ, WRITE:

> ### Sample Code:  
> ```
> 
> <Attribute name="scope" ref="">READ,WRITE</Attribute>
> ```



</td>
</tr>
</table>

On success, the following flow variables is set:

-   `oauthv2accesstoken.{policyName}.access_token`
-   `oauthv2accesstoken.{policyName}.client_id`
-   `oauthv2accesstoken.{policyName}.refresh_count`
-   `oauthv2accesstoken.{policyName}.organization_name`
-   `oauthv2accesstoken.{policyName}.expires_in`
-   `oauthv2accesstoken.{policyName}.refresh_token_expires_in`
-   `oauthv2accesstoken.{policyName}.issued_at`
-   `oauthv2accesstoken.{policyName}.status`
-   `oauthv2accesstoken.{policyName}.api_product_list`
-   `oauthv2accesstoken.{policyName}.token_type`
-   `oauthv2accesstoken.{policyName}.{custom_attribute_name}`

OAuth v2.0 SET policy defines the following errors:


<table>
<tr>
<th valign="top">

Error Name

</th>
<th valign="top">

Cause

</th>
</tr>
<tr>
<td valign="top">

invalid\_access\_token

</td>
<td valign="top">

The access token sent to the policy is invalid.

</td>
</tr>
<tr>
<td valign="top">

expired\_access\_token

</td>
<td valign="top">

The access token sent to the policy is expired.

</td>
</tr>
</table>

