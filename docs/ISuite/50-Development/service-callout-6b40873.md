<!-- loio6b4087345716471ebc83369f5fddd9c8 -->

# Service Callout

Use this policy to call an external service from your API flow.

A typical scenario consists of the service callout policy, from the response flow, calling a third party API.

On receiving a response from the backend service, you\(API developer\) then call the third party API. The response from this API is then appended to the original response to provide a mashed up response to the requesting application.

While using the Service Callout Policy, it is important to understand the other policies that provision to accomplish a task. The Service Callout is usually used with the Assign Message and Extract Variables policy. The Assign Message policy is used to populate the request message sent to the remote service. The Extract Variables policy is used to parse the response and to extract specific content.

A scenario where you use the three policies is as follows:

1.  **Assign Message Policy**: Creates a request message, populates HTTP headers, query parameters, sets the HTTP verb, and so on.
2.  **Service Callout Policy**: References a message created by the Assign Message policy, defines a target URL for the external call, and defines a name for the response object that the target service returns.
3.  **Extract Variables Policy**: Typically defines a JSONPath or XPath expression that parses the message generated by the preceding Service Callout policy. The policy then sets variables containing the values parsed from the Service Callout response.\`

You can attach the policy in the following locations: ![](images/Flow_policy_116062b.png)

An example payload for the policy is as follows:

> ### Code Syntax:  
> ```
> 
> 1. <!-- This policy will call the url api.exampleAPI.com and put the response in variable callOutResponse.
>   -- For examples refer the Flow Variables Table.--><?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <ServiceCallout async="true" continueOnError="false" enabled="true" xmlns="http://www.sap.com/apimgmt">
>     <Request clearPayload="true" variable="myRequest">
>         <Copy source="{source}">
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>             <Verb>{boolean_value}</Verb>
>             <Version>{boolean_value}</Version>
>             <Path>{boolean_value}</Path>
>             <StatusCode>{boolean_value}</StatusCode>
>             <ReasonPhrase>{boolean_value}</ReasonPhrase>
>         </Copy>
>         <Remove>
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>         </Remove>
>         <Add>
>             <Headers>
>                 <Header name=" {header_name }">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name }">{value}</QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>         </Add>
>         <Set>
>             <Headers>
>                 <Header name="{header_name}">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}">{value} </QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>             <Payload/>
>             <Verb>{verb}</Verb>
>             <Version>{version}</Version>
>             <Path>{path}</Path>
>             <StatusCode>{status_code}</StatusCode>
>             <ReasonPhrase>{reason_phrase}</ReasonPhrase>
>         </Set>
>         <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
>     </Request>
>     <Response>callOutResponse</Response>
>     <Timeout>30000</Timeout>
>     <HTTPTargetConnection>
>         <URL>http://api.exampleAPI.com/API</URL>
>     </HTTPTargetConnection>
> </ServiceCallout>
> 
> 
> 2. <!-- This policy will call a dynamic url which is set in the previous step via policies like javascript or assign variable..
>   -- For examples refer the Flow Variables Table.-->
> 
> <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <ServiceCallout async="true" continueOnError="false" enabled="true" xmlns="http://www.sap.com/apimgmt">
>     <Request clearPayload="true" variable="myRequest">
>         <Copy source="{source}">
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>             <Verb>{boolean_value}</Verb>
>             <Version>{boolean_value}</Version>
>             <Path>{boolean_value}</Path>
>             <StatusCode>{boolean_value}</StatusCode>
>             <ReasonPhrase>{boolean_value}</ReasonPhrase>
>         </Copy>
>         <Remove>
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>         </Remove>
>         <Add>
>             <Headers>
>                 <Header name=" {header_name }">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name }">{value}</QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>         </Add>
>         <Set>
>             <Headers>
>                 <Header name="{header_name}">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}">{value} </QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>             <Payload/>
>             <Verb>{verb}</Verb>
>             <Version>{version}</Version>
>             <Path>{path}</Path>
>             <StatusCode>{status_code}</StatusCode>
>             <ReasonPhrase>{reason_phrase}</ReasonPhrase>
>         </Set>
>         <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
>     </Request>
>     <Response>callOutResponse</Response>
>     <Timeout>30000</Timeout>
>     <HTTPTargetConnection>
>         <URL>http://{URL_path}</URL>
>     </HTTPTargetConnection>
> </ServiceCallout>
> Note: The protocol example http, https can't be set dynamically.
> 
> 
> 3. <!-- This policy below refers to an existing API Provider. -->
> 	You can use on-premise, and internet type of API Provider in the Service Callout policy.   	
> <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <ServiceCallout async="true" continueOnError="false" enabled="true" xmlns="http://www.sap.com/apimgmt">
>     <Request clearPayload="true" variable="myRequest">
>         <Copy source="{source}">
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>             <Verb>{boolean_value}</Verb>
>             <Version>{boolean_value}</Version>
>             <Path>{boolean_value}</Path>
>             <StatusCode>{boolean_value}</StatusCode>
>             <ReasonPhrase>{boolean_value}</ReasonPhrase>
>         </Copy>
>         <Remove>
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>         </Remove>
>         <Add>
>             <Headers>
>                 <Header name=" {header_name }">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name }">{value}</QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>         </Add>
>         <Set>
>             <Headers>
>                 <Header name="{header_name}">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}">{value} </QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>             <Payload/>
>             <Verb>{verb}</Verb>
>             <Version>{version}</Version>
>             <Path>{path}</Path>
>             <StatusCode>{status_code}</StatusCode>
>             <ReasonPhrase>{reason_phrase}</ReasonPhrase>
>         </Set>
>         <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
>     </Request>
>     <Response>callOutResponse</Response>
>     <Timeout>30000</Timeout>
>     <HTTPTargetConnection>
>         <APIProvider>API Provider Name</APIProvider>
>         <Path>/sap/opu/odata/iwfnd/RMTSAMPLEFLIGHT</Path>
>     </HTTPTargetConnection>
> </ServiceCallout>
> 
> 
> 4 (a). <!–- This policy briefs about SSL Info. SSL stands for Secure Socket Layer. It helps in encrypting the link between a web server and a web client, such as a browser or an app.
> Although the encrypted link ensures that all data passing between the server and the client remains private. The SSL Info does not support if the API 
> Provider is added to HTTPTargetConnection.  
> Henceforth, there can never be a case where API Provider-SSL Configuration conflicts with SSL Info present in the Service Callout Policy.  
> 
> If enabled = "true" in the code;follow the below code. --><?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <ServiceCallout async="true" continueOnError="false" enabled="true" xmlns="http://www.sap.com/apimgmt">
>     <Request clearPayload="true" variable="myRequest">
>         <Copy source="{source}">
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>             <Verb>{boolean_value}</Verb>
>             <Version>{boolean_value}</Version>
>             <Path>{boolean_value}</Path>
>             <StatusCode>{boolean_value}</StatusCode>
>             <ReasonPhrase>{boolean_value}</ReasonPhrase>
>         </Copy>
>         <Remove>
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>         </Remove>
>         <Add>
>             <Headers>
>                 <Header name=" {header_name }">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name }">{value}</QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>         </Add>
>         <Set>
>             <Headers>
>                 <Header name="{header_name}">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}">{value} </QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>             <Payload/>
>             <Verb>{verb}</Verb>
>             <Version>{version}</Version>
>             <Path>{path}</Path>
>             <StatusCode>{status_code}</StatusCode>
>             <ReasonPhrase>{reason_phrase}</ReasonPhrase>
>         </Set>
>         <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
>     </Request>
>     <Response>callOutResponse</Response>
>     <Timeout>30000</Timeout>
>     <HTTPTargetConnection>
>         <URL>https://maps.googleapis.com/maps/api/geocode/json/</URL>
>         <SSLInfo>
>             <Enabled>true</Enabled>
>             <ClientAuthEnabled>true</ClientAuthEnabled>
>             <KeyStore>SapKeystore</KeyStore>
>             <KeyAlias>SAPKey</KeyAlias>
>             <TrustStore>SAPTruststore</TrustStore>
>             <Ciphers/>
>             <Protocols/>
>         </SSLInfo>
>     </HTTPTargetConnection>
> </ServiceCallout>
>  
> 
> 4 (b).Use the SSL Info code below, If enabled is set to false.
> 
> <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <ServiceCallout async="true" continueOnError="false" enabled="false" xmlns="http://www.sap.com/apimgmt">
>     <Request clearPayload="true" variable="myRequest">
>         <Copy source="{source}">
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>             <Verb>{boolean_value}</Verb>
>             <Version>{boolean_value}</Version>
>             <Path>{boolean_value}</Path>
>             <StatusCode>{boolean_value}</StatusCode>
>             <ReasonPhrase>{boolean_value}</ReasonPhrase>
>         </Copy>
>         <Remove>
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>         </Remove>
>         <Add>
>             <Headers>
>                 <Header name=" {header_name }">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name }">{value}</QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>         </Add>
>         <Set>
>             <Headers>
>                 <Header name="{header_name}">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}">{value} </QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>             <Payload/>
>             <Verb>{verb}</Verb>
>             <Version>{version}</Version>
>             <Path>{path}</Path>
>             <StatusCode>{status_code}</StatusCode>
>             <ReasonPhrase>{reason_phrase}</ReasonPhrase>
>         </Set>
>         <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
>     </Request>
>     <Response>callOutResponse</Response>
>     <Timeout>30000</Timeout>
>     <HTTPTargetConnection>
>         <URL>https://maps.googleapis.com/maps/api/geocode/json/</URL>
>     </HTTPTargetConnection>
> </ServiceCallout>
> 
> 
> 
> 5. In this Service callout policy, you call a local API Proxy in 2 ways;
> 
> 	
> 5 (a). Using local <APIProxy> and <ProxyEndpoint>
> <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <ServiceCallout async="true" continueOnError="false" enabled="true" xmlns="http://www.sap.com/apimgmt">
>     <Request clearPayload="true" variable="myRequest">
>         <Copy source="{source}">
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>             <Verb>{boolean_value}</Verb>
>             <Version>{boolean_value}</Version>
>             <Path>{boolean_value}</Path>
>             <StatusCode>{boolean_value}</StatusCode>
>             <ReasonPhrase>{boolean_value}</ReasonPhrase>
>         </Copy>
>         <Remove>
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>         </Remove>
>         <Add>
>             <Headers>
>                 <Header name=" {header_name }">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name }">{value}</QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>         </Add>
>         <Set>
>             <Headers>
>                 <Header name="{header_name}">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}">{value} </QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>             <Payload/>
>             <Verb>{verb}</Verb>
>             <Version>{version}</Version>
>             <Path>{path}</Path>
>             <StatusCode>{status_code}</StatusCode>
>             <ReasonPhrase>{reason_phrase}</ReasonPhrase>
>         </Set>
>         <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
>     </Request>
>     <Response>callOutResponse</Response>
>     <Timeout>30000</Timeout>
>     <LocalTargetConnection>
>         <APIProxy>api-admin</APIProxy>
>         <ProxyEndpoint>default</ProxyEndpoint>
>     </LocalTargetConnection>
> </ServiceCallout>
> 
> 
> In the above code,'api-admin' is an example for local API Proxy.
> 
> 
> 5 (b). Using the path parameter.
> This can also help in calling a local API Proxy since the path parameter could be a consistent target.
>  
> <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
> <ServiceCallout async="true" continueOnError="false" enabled="true" xmlns="http://www.sap.com/apimgmt">
>     <Request clearPayload="true" variable="myRequest">
>         <Copy source="{source}">
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>             <Verb>{boolean_value}</Verb>
>             <Version>{boolean_value}</Version>
>             <Path>{boolean_value}</Path>
>             <StatusCode>{boolean_value}</StatusCode>
>             <ReasonPhrase>{boolean_value}</ReasonPhrase>
>         </Copy>
>         <Remove>
>             <Headers>
>                 <Header name="{header_name}"></Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}"></QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}"></FormParam>
>             </FormParams>
>             <Payload>{boolean_value}</Payload>
>         </Remove>
>         <Add>
>             <Headers>
>                 <Header name=" {header_name }">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name }">{value}</QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>         </Add>
>         <Set>
>             <Headers>
>                 <Header name="{header_name}">{value}</Header>
>             </Headers>
>             <QueryParams>
>                 <QueryParam name="{query_param_name}">{value} </QueryParam>
>             </QueryParams>
>             <FormParams>
>                 <FormParam name="{form_param_name}">{value}</FormParam>
>             </FormParams>
>             <Payload/>
>             <Verb>{verb}</Verb>
>             <Version>{version}</Version>
>             <Path>{path}</Path>
>             <StatusCode>{status_code}</StatusCode>
>             <ReasonPhrase>{reason_phrase}</ReasonPhrase>
>         </Set>
>         <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
>     </Request>
>     <Response>callOutResponse</Response>
>     <Timeout>30000</Timeout>
>     <LocalTargetConnection>
>         <Path><"API Basepath"></Path>
>     </LocalTargetConnection>
> </ServiceCallout>
> 			
> 
> Note: If you are referring to <LocalTargetConnection> tag, then don't include <HTTPTargetConnection> tag and vice versa.
> 
> 
> 
> 
> ```

A callout is typically used with two other policies: Assign Message and Extract Variables.

-   Request: Assign Message populates the request message sent to the remote service.

-   Response: Extract Variables parses the response and extracts specific content.



<table>
<tr>
<th valign="top">

**Elements and Attributes**

</th>
<th valign="top">

**Description**

</th>
</tr>
<tr>
<td valign="top">

Request \(Optional\)

</td>
<td valign="top">

The variable that contains the request message to be sent by the ServiceCallout.

-   By default, `'clearPayload'` is `false`.
-   If `clearPayload` is set to `true`, the request payload is cleared after the request is sent to the HTTP target.
-   Use the clearPayload option only if the request message is not required after the Service Callout is executed, because `clearPayload` allocates memory during message processing.
-   The policy returns an error if the request message cannot be resolved by the element or it is of an invalid request message type.



</td>
</tr>
<tr>
<td valign="top">

Response \(Optional\)

</td>
<td valign="top">

Output of the ServiceCallout \(usually the response message received from the target\) that will be assigned to the response variable.

The output generated by the policy is assigned to the variable only when the entire response is read successfully by the policy. If the response message fails for any reason, the policy returns an error.

If this element is not specified, the policy execution does not wait for response to be completely read and executes the message flow steps.

</td>
</tr>
<tr>
<td valign="top">

Timeout \(Optional\)

</td>
<td valign="top">

The time in milliseconds that the ServiceCallout policy will wait for a response from the target before exiting. The default timeout for ServiceCallout is determined by the default HTTP timeout setting for API Management, which is 55000 milliseconds \(55 seconds\).

</td>
</tr>
<tr>
<td valign="top">

HTTPTargetConnection

</td>
<td valign="top">

Provides transport details such as URL and HTTP properties.

> ### Note:  
> You can use flow variables to construct the URL in an HttpTargetConnectionelement.

**<HTTPTargetConnection\>/<URL\> element:** 

You can supply portion of the URL that changes with a variable. Although, the protocol part of the URL, http:// beneath, cannot be stated by a variable. In the next example, you use a variable to emphasize the value of query parameter.

**<URL\>**http://example.com/forecastrss?w=$\{request.header.woeid\}**</URL\>**

Or, set a part of the URL path by a variable:

**<URL\>**http://example.com/\{request.resourcePath\}?w=$\{request.header.woeid\}**</URL\>**

If you need to use a variable to quantify the domain and port of the URL, then use one variable alone for the domain and port, and a second variable for the other portion of the URL:

**<URL\>**http://\{request.dom\_port\}/\{request.resourcePath\}**</URL\>**

Refer sample code \(1\)

**<LocalTargetConnection\> element:**

It quantifies a local proxy within the environment and acts as the target of service callouts.

**<LocalTargetConnection\>/<ProxyEndpoint\> element**

It is a proxy endpoint in the API proxy quantified with the <APIProxy\> element.

Refer sample code 4 \(a\)

**<LocalTargetConnection\>/<Path\> element**

It targets the path to the endpoint. The endpoint must refer to a local proxy while making the call.

Refer sample code 4 \(b\).

</td>
</tr>
</table>

**Flow variables**

They allow dynamic performance of policies and flows at runtime. It’s based on HTTP headers, message content, or Flow context. The following Flow variables are available and predefined after a Service Callout policy is executed.

**Flow Variables Table**


<table>
<tr>
<th valign="top">

Variable

</th>
<th valign="top">

Description

</th>
</tr>
<tr>
<td valign="top">

Following is an example of getting Service Callout request and response headers similar to how you would get headers from the main request and response.

`calloutResponse.header.HeaderName`

`myRequest.header.HeaderName`

where calloutResponse is the variable name for the Response in the Service Callout, and myRequest is the variable name for the Request. For example:

`calloutResponse.header.Content-Length`

returns the Content-Length header of the Service Callout response.

</td>
<td valign="top">

Scope: From the Service Callout forward

Type: String

Permission: Read/Write

A message header in the Service Callout request or response

</td>
</tr>
<tr>
<td valign="top">

`servicecallout.requesturi` 

</td>
<td valign="top">

Scope: From the Service Callout request forward

Type: String

Permission: Read/Write

The TargetEndpoint URI for a ServiceCallout policy. The URI is the TargetEndpoint URL without the protocol and domain specification.

</td>
</tr>
<tr>
<td valign="top">

`servicecallout.{policy-name}.target.url` 

</td>
<td valign="top">

Scope: From the Service Callout request forward

Type: String

Permission: Read/Write

The target URL for the Service Callout.

</td>
</tr>
<tr>
<td valign="top">

`calloutResponse.content`

where `calloutResponse` is the <Response\>variable name in the Service Callout configuration.

</td>
<td valign="top">

Scope: From the Service Callout response forward

Type: String

Permission: Read/Write

The response body from the Service Callout.

</td>
</tr>
<tr>
<td valign="top">

`servicecallout.{policy-name}.expectedcn` 

</td>
<td valign="top">

Scope: From the Service Callout request forward

Type: String

Permission: Read/Write

The expected Common Name of the TargetEndpoint as referred to in a ServiceCallout policy. This is meaningful only when the TargetEndpoint refers to an TLS/SSL endpoint.

</td>
</tr>
<tr>
<td valign="top">

`servicecallout.{policy-name}.failed` 

</td>
<td valign="top">

Scope: From the Service Callout response forward

Type: Boolean

Permission: Read/Write

Boolean indicating if the policy succeeded, false, or failed, true.

</td>
</tr>
</table>

**Errors**

This segment defines the fault codes and error messages that are returned.

During the policy execution, the following errors can occur:

**Error Code**


<table>
<tr>
<th valign="top">

Error Name

</th>
<th valign="top">

Cause

</th>
</tr>
<tr>
<td valign="top">

RequestVariableNotMessageType

</td>
<td valign="top">

The Request variable specified in the policy is not of type Message. For example, if it's a string or other non-message type, you'll see this error.

</td>
</tr>
<tr>
<td valign="top">

RequestVariableNotRequest\\MessageType

</td>
<td valign="top">

The Request variable specified in the policy is not of type Request Message. For example, if it's a Response type, you'll see this error.

</td>
</tr>
<tr>
<td valign="top">

ExecutionFailed

</td>
<td valign="top">

This error can occur when:

-   The policy is asked to handle input that is malformed or otherwise invalid.
-   The backend target service returns an error status \(by default, 4xx or 5xx\).



</td>
</tr>
<tr>
<td valign="top">

ErrorResponseCode

</td>
<td valign="top">

The backend target service returns an error status \(by default, 4xx or 5xx\).

</td>
</tr>
<tr>
<td valign="top">

InvalidExecutionState

</td>
<td valign="top">

JSONThreatProtection\[policy\_name\]: Exceeded string value length at line \[line\_num\]

</td>
</tr>
<tr>
<td valign="top">

URLMissing

</td>
<td valign="top">

The <URL\> element inside <HTTPTargetConnection\> is missing or empty.

</td>
</tr>
<tr>
<td valign="top">

ConnectionInfoMissing

</td>
<td valign="top">

This error happens if the policy does not have an <HTTPTargetConnection\> element.

</td>
</tr>
<tr>
<td valign="top">

InvalidTimeoutValue

</td>
<td valign="top">

This error happens if the <Timeout\> value is negative or zero.

</td>
</tr>
</table>

**Runtime Errors**


<table>
<tr>
<th valign="top">

**Fault Code** 

</th>
<th valign="top">

**Cause** 

</th>
</tr>
<tr>
<td valign="top">

steps.servicecallout.Executionfailed

</td>
<td valign="top">

This error can arise when:

The policy is requested to handle input that is distorted or otherwise unacceptable.

</td>
</tr>
<tr>
<td valign="top">

steps.servicecallout.RequestVariableNotMessageType

</td>
<td valign="top">

The Request variable is quantified in the policy and is not of type Message. For instance, if it's a string or other non-message type, you'll encounter this error.

</td>
</tr>
<tr>
<td valign="top">

steps.servicecallout.RequestVariableNotRequestMessageType

</td>
<td valign="top">

The Request variable quantified in the policy is not of type Request Message. For instance, if it's a Response type, you'll encounter this error.

</td>
</tr>
</table>

**sample error response**

> ### Sample Code:  
> ```
> {  
>    "fault":{  
>       "detail":{  
>          "errorcode":"steps.servicecallout.RequestVariableNotMessageType"
>       },
>       "faultstring":"ServiceCallout[ServiceCalloutGetMockResponse]: 
>             request variable data_str value is not of type Message"
>    }
> }
> 
> ```

**Sample fault rule**

> ### Sample Code:  
> ```
> <faultrule name="VariableOfNonMsgType"></faultrule><FaultRule name="RequestVariableNotMessageType">
>     <Step>
>         <Name>AM-RequestVariableNotMessageType</Name>
>     </Step>
>     <Condition>(fault.name = "RequestVariableNotMessageType")</Condition>
> </FaultRule>
> 
> ```

Following fault variables are set when the policy triggers an error at runtime:

**Fault Variables**


<table>
<tr>
<th valign="top">

Variable Set

</th>
<th valign="top">

Where

</th>
<th valign="top">

Example

</th>
</tr>
<tr>
<td valign="top">

\[prefix\].\[policy\_name\].failed

</td>
<td valign="top">

The \[prefix\] is servicecallout.

\[policy\_name\]: The name of the policy to check.

</td>
<td valign="top">

servicecallout.SC-GetUserData.failed = true

</td>
</tr>
<tr>
<td valign="top">

fault.\[error\_name\]

</td>
<td valign="top">

\[error\_name\] = The specific error name to check for as listed in the table above.

</td>
<td valign="top">

fault.name = "RequestVariableNotMessageType"

</td>
</tr>
</table>

**Related Information**  


[Assign Message](assign-message-523efe6.md "This policy allows you to create new or modify an existing HTTP request or response message.")

[Extract Variables](extract-variables-dad6ef6.md "The Extract variables policy can be used to extract content from the HTTP request or response messages of the API Proxy and assign that content to specific variables that can be accessed during the execution of the API Proxy.")

