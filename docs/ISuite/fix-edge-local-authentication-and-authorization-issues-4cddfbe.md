<!-- loio4cddfbecd3084c2c9d9ad7df7db64767 -->

# Fix Edge Local Authentication and Authorization Issues

Check and fix issues related to local authentication and authorization.



<a name="loio4cddfbecd3084c2c9d9ad7df7db64767__context_cn2_43b_1fc"/>

## Context

Local authentication and authorization removes the real-time dependency on the SAP Business Technology Platform SAP BTP for inbound authentication and authorization. Currently, only certificate authentication is supported. Authentication and authorization errors may occur after the solution is upgraded, or after a new service instance of the Process Integration Runtime type is created/modified. Additionally, creating a service key for an existing Process Integration Runtime service instance may also lead to authentication and authorization errors. The following errors occur upon invocation of integration flow or API artefact.

> ### Output Code:  
> ```
> {
>     "error": {
>         "code": "unauthorized",
>         "message": "{\"result\":{\"access_token\":\"\",\"error\":\" Check SAP Edge Integration Cell authentication logs with ID: 337649\",\"globalSeverity\":1,\"logId\":337649,\"responseCode\":401}}\n"
>     }
> }
> 
> ```

To resolve the authentication error, perform the following steps:



## Procedure

1.  To fetch the Edge Local Authentication and Authorization pods, enter the following command in the kubectl tool: `kubectl get pods -n edge-icell-ela`. This will return a list of pods labeled as `ela-server-xxxxxxxxxx-yyyyy`.

2.  To access the Edge Local Authentication and Authorization logs and save them into a file in your current working directory, enter the following command: `kubectl logs ela-server-xxxxxxxxxx-yyyyy -n edge-icell-ela opa > ela-server-xxxxxxxxxx-yyyyy`. In this context, `ela-server-xxxxxxxxxx-yyyyy` represents the name of the pod from the list generated by the previous command. If multiple pods appear in the list, run the command specified above for every single pod.

3.  Open the files with a text editor and search for the log entries. In particular, look for entries containing the `logId/ID` detailed in the error message.

4.  To troubleshoot based on the error message, follow the subsequent steps.


    <table>
    <tr>
    <th valign="top">

    Error Message
    
    </th>
    <th valign="top">

    Action
    
    </th>
    </tr>
    <tr>
    <td valign="top">
    
    **\#Error: unable to find stored credentials matching the authentication request certificate**
    
    </td>
    <td valign="top">
    
    If you're unsure if a certain key has been recreated, create a new one. Once that's done, you'll need to use this new certificate/key to run the iFlow/API artefact function.

    > ### Note:  
    > If your service key is of the *External Certificate* type, you don't need to start from scratch - you can use your old certificate when making a new service key.

    Your newly created service key synchronizes with the Edge Local Authentication and Authorization component within a matter of minutes. Additionally, every 170 minutes, a snapshot synchronization job runs to ensure the consistency of the security material between cloud and Edge Integration Cell. Once the synchronization is complete, try running the integration flow/API artefact function again. Make sure to use the certificate and key from your new service key.

    If you still encounter the error, create a support ticket on the component *BC-CP-IS-EDG-ELA*.
    
    </td>
    </tr>
    <tr>
    <td valign="top">
    
    \#error: unable to find stored credentials matching the authentication request certificate \(for Service Keys of type External Certificate\)
    
    </td>
    <td valign="top">
    
    For service keys of type *External Certificate*, where the *Pin Certificate* setting is disabled, check whether the external client certificate is renewed. After using a renewed certificate for authentication purposes, the system no longer accepts the previously used certificate with an older issue date.

    Your newly created service key should synchronize with the Edge Local Authentication and Authorization component within a matter of minutes. Additionally, every 170 minutes a snapshot synchronization job runs, to ensure the consistency of the security material between the cloud and Edge Integration Cell. Once synchronization is complete, attempt to run the integration flow/API artefact function again. Make sure to use the certificate and key from your new service key.

    If you still encounter the error, create a support ticket on the component *BC-CP-IS-EDG-ELA*
    
    </td>
    </tr>
    </table>
    

**Related Information**  


[Creating Service Instance and Service Key for Inbound Authentication](40-RemoteSystems/creating-service-instance-and-service-key-for-inbound-authentication-19af5e2.md "With a service instance, you define how to access a certain SAP BTP service. In the context of SAP Integration Suite , a service instance is the definition of an OAuth client.")

